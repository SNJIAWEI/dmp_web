{% extends "base.html" %}
{% load staticfiles %}
{% block privateJsAndCss %}
<!--<script src="{% static echarts/echarts.min.js" %}"></script> -->
<script>
  	$(document).ready(function(){
   // elasticsearch.jquery.js  版
   var client = new $.es.Client({
        hosts: 'http://58.61.152.2:9210',
        log: 'trace' //输出详细的调试信息
      });

      client.ping({
        requestTimeout: 3000,
        hello: "elasticsearch"
      }, function (error) {
        if (error) {
          //console.error('elasticsearch cluster is down!');
        } else {
          //console.log('All is well');
        }
      });

      client.search({
        index: 'test2',
        type: 'taglib',
        body: {
          "query":{
    "query_string": {
      //"query": "gender:* AND ( M160000:* OR M180004:* OR M000000:* ) OR lfstage:*"
      "query": "inst:*"
    }
  }
	,"aggs":
	{
	"aggsflow":{
	"sum":{"field":"flow"}
	},
	"aggsgender":{"terms":{"field":"gender"}},
	"aggsage":{"terms":{"field":"age"}},
	"aggslfstage":{"terms":{"field":"lfstage"}},
	"aggsinst":{
	"terms": {
	"size":5,
	"field": "inst"
	}
	},
	"aggsinstOneLev":{
	"terms": {
	"size":5,
	"field": "instOneLev"
	}
	},
	"aggslocation":{
	"terms": {
	"size":5,
	"field": "location"
	}
	},
	"aggslocOneLev":{
	"terms": {
	"size":3,
	"field": "locOneLev"
	}
	},
	"aggskeys":{
	"significant_terms": {
	"size":20,
	"field": "keys"
	}
	},
	"aggscategory":{
	"terms": {
	"field": "category"
	}
	},
	"aggsprovince":{
	"terms": {
	"field": "province"
	}
	}
	,
	"aggsprice":{
	"terms": {
	"field": "price"
	}
	}
	,
	"aggsbrand":{
	"terms": {
	"field": "brand"
	}
	}
	,
	"aggsisp":{
	"terms": {
	"field": "isp"
	}
	},
	"aggsnetwork":{
	"terms": {
	"field": "network"
	}
	},
	"aggsclient":{
	"terms": {
	"field": "client"
	}
	},"aggsmidea":{
		"terms": {
	"field": "midea"
	}
	}
	}
}
      }).then(function (resp) {
        // 年龄
        var ageMap ={"p01030001":"0-12","p01030002":"12-19","p01030003":"19-25","p01030004":"25-30","p01030005":"30-35","p01030006":"35-40","p01030007":"40-45","p01030008":"45-60","p01030009":"60以上"};
        var age=resp.aggregations.aggsage.buckets;
		str =""
        for (var i=0;i<age.length;i++){
		if(i>0){
		str += ','
		}
		str += "{value:"+age[i].doc_count+",name:'"+ageMap[age[i].key]+"'}"
        	}
			optionage.series[0].data = eval('[' + str + ']') ;
    		chartage.setOption(optionage,true);

      },function (err) {
       $('#results').html(JSON.stringify(err))
       console.trace(err.message);
      });


	})
	});


</script>


{% endblock %}

{% block currentNav %}
<li><a href="#">总览</a></li>
<li><a href="/dmp/structmans/">人群构建</a></li>
<li class="active"><a href="/dmp/humananalyse/">人群分析</a></li>
<li><a href="#">用户画像</a></li>
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown"> 数据字典 <b class="caret"></b></a>
    <ul class="dropdown-menu">
        <li><a href="/dmp/phoneinfo/">手机标注</a></li>
        <li class="active"><a href="#">APP标注</a></li>
        <li><a href="/dmp/locations/">位置信息</a></li>
        {#
        <li><a href="/dmp/ads/">广告信息</a></li>
        #}
        <li><a href="/dmp/interest/">兴趣映射</a></li>
    </ul>
</li>
<li><a href="#">工具</a></li>
<li><a href="/admin" target="_blank">管理</a></li>
{% endblock %}

{% block contentPage %}
<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">{{ elastic_condition }}</a>
        </div>
    </div>
</nav>

<div class="row">
    <div class="col-md-6" style="height: 400px;" id="main"></div>
    <div class="col-md-6" style="height: 400px;" id="main2"></div>
</div>

<div id="main3" style="width: 600px;height:400px;"></div>
<script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));
        var myChart2 = echarts.init(document.getElementById('main2'));
        var myChart3 = echarts.init(document.getElementById('main3'));

        // 指定图表的配置项和数据
        var option = {
            title: {
                text: 'ECharts 入门示例'
            },
            tooltip: {},
            legend: {
                data:['销量']
            },
            xAxis: {
                data: ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
            },
            yAxis: {},
            series: [{
                name: '销量',
                type: 'bar',
                data: [5, 20, 36, 10, 10, 20]
            }]
        };


        var option2 = {
            title: {
                text: '堆叠条形图'
            },
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            legend: {
                data: ['直接访问', '邮件营销','联盟广告','视频广告','搜索引擎']
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis:  {
                type: 'value'
            },
            yAxis: {
                type: 'category',
                data: ['周一','周二','周三','周四','周五','周六','周日']
            },
            series: [
                {
                    name: '直接访问',
                    type: 'bar',
                    stack: '总量',
                    label: {
                        normal: {
                            show: true,
                            position: 'insideRight'
                        }
                    },
                    data: [320, 302, 301, 334, 390, 330, 320]
                },
                {
                    name: '邮件营销',
                    type: 'bar',
                    stack: '总量',
                    label: {
                        normal: {
                            show: true,
                            position: 'insideRight'
                        }
                    },
                    data: [120, 132, 101, 134, 90, 230, 210]
                },
                {
                    name: '联盟广告',
                    type: 'bar',
                    stack: '总量',
                    label: {
                        normal: {
                            show: true,
                            position: 'insideRight'
                        }
                    },
                    data: [220, 182, 191, 234, 290, 330, 310]
                },
                {
                    name: '视频广告',
                    type: 'bar',
                    stack: '总量',
                    label: {
                        normal: {
                            show: true,
                            position: 'insideRight'
                        }
                    },
                    data: [150, 212, 201, 154, 190, 330, 410]
                },
                {
                    name: '搜索引擎',
                    type: 'bar',
                    stack: '总量',
                    label: {
                        normal: {
                            show: true,
                            position: 'insideRight'
                        }
                    },
                    data: [820, 832, 901, 934, 1290, 1330, 1320]
                }
            ]
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    myChart2.setOption(option2);
    myChart3.setOption(option);

</script>
{% endblock %}
